<html>
<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1, minimum-scale=1, user-scalable=no" name="viewport" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <title>Next Train</title>
    <style>
        ::-webkit-scrollbar { display: none }
        html,
        body  { margin: 0px; padding: 0px; font-family: -apple-system, Arial; background-color: #e0e0e0;
                -webkit-user-select: none; user-select: none; -webkit-tap-highlight-color: transparent; overflow: hidden; }
        #spin { display: none; width: 20px; position: absolute; top: 10px; right: 30px; }
        #titl { text-align: center; margin: 5px 0px; font-weight: bold; }
        #time { margin: 5px 0px; padding: 0px 20px; font-size: 10px; color: #a0a0a0; font-style: italic; }
        .sta  { background-color: #d0d0d0; margin: 5px 10px 15px 10px; padding: 10px; border-radius: 5px; font-weight: bold; }
        .name { font-size: 20px; margin-bottom: 20px; }
        #main { overflow: scroll; border-top: 2px #e0e0e0 solid; scrollbar-color: red; } #main.scrolling { border-top: 2px #999 solid; }
        .dest { margin-top: 5px; color: white; padding: 5px; border-radius: 5px; }
        .plat { display: inline-block; width: 15px; margin-right: 5px; text-align: center; }
        .ttnt { float: right; }
        .sTCL { background-color: #F7943E }
        .sISL { background-color: #007DC5 }
        .sTML { background-color: #923011 }
        .sAEL { background-color: #00888A }
        .sTWL { background-color: #ED1D24 }
        #bpad { height: 50px; }
    </style>
</head>
<body>
    <div id="titl">Next Train<div id="time"></div></div>
    <img id="spin" src="loading.gif" />
    <div id="main"></div>
    <!-- template -->
    <template id="Tsta"><div class="sta"><div class="name">{{sta}} {{prox}}</div><div>{{{plats}}}</div></div></template>
    <template id="TstaDest"><div class="dest s{{line}}"><span class="plat">{{plat}}</span><span>{{dest}}</span><span style="float: right; font-weight: normal">&nbsp;mins</span><span class="ttnt">{{ttnt}}</span></div></template>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/0.1/mustache.min.js"></script>
    <script>
        const $ = document.querySelector.bind( document );
        const DEFAULT_STA = ['NAC', 'HOK', 'SYP', 'CEN']; var PROX_STA = [];
        const REF = {"ADM":{"line":{"EAL":{},"ISL":{},"TWL":{},"SIL":{}},"chi":"ÈáëÈêò","eng":"Admiralty"},"AIR":{"line":{"AEL":{}},"chi":"Ê©üÂ†¥","eng":"Airport"},"AUS":{"line":{"TML":{}},"chi":"ÊüØÂ£´Áî∏","eng":"Austin"},"AWE":{"line":{"AEL":{}},"chi":"ÂçöË¶ΩÈ§®","eng":"AsiaWorld-Expo"},"CAB":{"line":{"ISL":{}},"chi":"ÈäÖÈëºÁÅ£","eng":"Causeway Bay"},"CEN":{"line":{"ISL":{},"TWL":{}},"chi":"‰∏≠Áí∞","eng":"Central"},"CHH":{"line":{"KTL":{}},"chi":"ÂΩ©Ëôπ","eng":"Choi Hung"},"CHW":{"line":{"ISL":{}},"chi":"Êü¥ÁÅ£","eng":"Chai Wan"},"CIO":{"line":{"TML":{}},"chi":"Á¨¨‰∏ÄÂüé","eng":"City One"},"CKT":{"line":{"TML":{}},"chi":"ËªäÂÖ¨Âªü","eng":"Che Kung Temple"},"CSW":{"line":{"TWL":{}},"chi":"Èï∑Ê≤ôÁÅ£","eng":"Cheung Sha Wan"},"DIH":{"line":{"KTL":{},"TML":{}},"chi":"ÈëΩÁü≥Â±±","eng":"Diamond Hill"},"DIS":{"line":{"DRL":{}},"chi":"Ëø™Â£´Â∞º","eng":"Disneyland Resort"},"ETS":{"line":{"TML":{}},"chi":"Â∞ñÊù±","eng":"East Tsim Sha Tsui"},"EXC":{"line":{"EAL":{}},"chi":"ÊúÉÂ±ï","eng":"Exhibition Centre"},"FAN":{"line":{"EAL":{}},"chi":"Á≤âÂ∂∫","eng":"Fanling"},"FOH":{"line":{"ISL":{}},"chi":"ÁÇÆÂè∞Â±±","eng":"Fortress Hill"},"FOT":{"line":{"EAL":{}},"chi":"ÁÅ´ÁÇ≠","eng":"Fo Tan"},"HAH":{"line":{"TKL":{}},"chi":"ÂùëÂè£","eng":"Hang Hau"},"HEO":{"line":{"TML":{}},"chi":"ÊÅÜÂÆâ","eng":"Heng On"},"HFC":{"line":{"ISL":{}},"chi":"ÊùèËä±ÈÇ®","eng":"Heng Fa Chuen"},"HIK":{"line":{"TML":{}},"chi":"È°ØÂæë","eng":"Hin Keng"},"HKU":{"line":{"ISL":{}},"chi":"È¶ôÊ∏ØÂ§ßÂ≠∏","eng":"HKU"},"HOK":{"line":{"AEL":{},"TCL":{}},"chi":"È¶ôÊ∏Ø","eng":"Hong Kong"},"HOM":{"line":{"KTL":{},"TML":{}},"chi":"‰ΩïÊñáÁî∞","eng":"Ho Man Tin"},"HUH":{"line":{"EAL":{},"TML":{}},"chi":"Á¥ÖÁ£°","eng":"Hung Hom"},"JOR":{"line":{"TWL":{}},"chi":"‰ΩêÊï¶","eng":"Jordan"},"KAT":{"line":{"TML":{}},"chi":"ÂïüÂæ∑","eng":"Kai Tak"},"KET":{"line":{"ISL":{}},"chi":"Â†ÖÂ∞ºÂú∞Âüé","eng":"Kennedy Town"},"KOB":{"line":{"KTL":{}},"chi":"‰πùÈæçÁÅ£","eng":"Kowloon Bay"},"KOT":{"line":{"EAL":{},"KTL":{}},"chi":"‰πùÈæçÂ°ò","eng":"Kowloon Tong"},"KOW":{"line":{"AEL":{},"TCL":{}},"chi":"‰πùÈæç","eng":"Kowloon"},"KSR":{"line":{"TML":{}},"chi":"Èå¶‰∏äË∑Ø","eng":"Kam Sheung Road"},"KWF":{"line":{"TWL":{}},"chi":"ËëµËä≥","eng":"Kwai Fong"},"KWH":{"line":{"TWL":{}},"chi":"ËëµËàà","eng":"Kwai Hing"},"KWT":{"line":{"KTL":{}},"chi":"ËßÄÂ°ò","eng":"Kwun Tong"},"LAK":{"line":{"TCL":{},"TWL":{}},"chi":"ËåòÊôØ","eng":"Lai King"},"LAT":{"line":{"KTL":{}},"chi":"ËóçÁî∞","eng":"Lam Tin"},"LCK":{"line":{"TWL":{}},"chi":"ËåòÊûùËßí","eng":"Lai Chi Kok"},"LET":{"line":{"SIL":{}},"chi":"Âà©Êù±","eng":"Lei Tung"},"LHP":{"line":{"TKL":{}},"chi":"Â∫∑Âüé","eng":"LOHAS Park"},"LMC":{"line":{"EAL":{}},"chi":"ËêΩÈ¶¨Ê¥≤","eng":"Lok Ma Chau"},"LOF":{"line":{"KTL":{}},"chi":"Ê®ÇÂØå","eng":"Lok Fu"},"LOP":{"line":{"TML":{}},"chi":"ÊúóÂ±è","eng":"Long Ping"},"LOW":{"line":{"EAL":{}},"chi":"ÁæÖÊπñ","eng":"Lo Wu"},"MEF":{"line":{"TML":{},"TWL":{}},"chi":"ÁæéÂ≠ö","eng":"Mei Foo"},"MKK":{"line":{"EAL":{}},"chi":"Êó∫ËßíÊù±","eng":"Mong Kok East"},"MOK":{"line":{"KTL":{},"TWL":{}},"chi":"Êó∫Ëßí","eng":"Mong Kok"},"MOS":{"line":{"TML":{}},"chi":"È¶¨ÈûçÂ±±","eng":"Ma On Shan"},"NAC":{"line":{"TML":{},"TCL":{}},"chi":"ÂçóÊòå","eng":"Nam Cheong"},"NOP":{"line":{"ISL":{},"TKL":{}},"chi":"ÂåóËßí","eng":"North Point"},"NTK":{"line":{"KTL":{}},"chi":"ÁâõÈ†≠Ëßí","eng":"Ngau Tau Kok"},"OCP":{"line":{"SIL":{}},"chi":"Êµ∑Ê¥ãÂÖ¨Âúí","eng":"Ocean Park"},"OLY":{"line":{"TCL":{}},"chi":"Â•ßÈÅã","eng":"Olympic"},"POA":{"line":{"TKL":{}},"chi":"ÂØ∂Áê≥","eng":"Po Lam"},"PRE":{"line":{"KTL":{},"TWL":{}},"chi":"Â§™Â≠ê","eng":"Prince Edward"},"QUB":{"line":{"ISL":{},"TKL":{}},"chi":"È∞ÇÈ≠öÊ∂å","eng":"Quarry Bay"},"SHM":{"line":{"TML":{}},"chi":"Áü≥ÈñÄ","eng":"Shek Mun"},"SHS":{"line":{"EAL":{}},"chi":"‰∏äÊ∞¥","eng":"Sheung Shui"},"SHT":{"line":{"EAL":{}},"chi":"Ê≤ôÁî∞","eng":"Sha Tin"},"SHW":{"line":{"ISL":{}},"chi":"‰∏äÁí∞","eng":"Sheung Wan"},"SIH":{"line":{"TML":{}},"chi":"ÂÖÜÂ∫∑","eng":"Siu Hong"},"SKM":{"line":{"KTL":{}},"chi":"Áü≥Á°§Â∞æ","eng":"Shek Kip Mei"},"SKW":{"line":{"ISL":{}},"chi":"Á≠≤ÁÆïÁÅ£","eng":"Shau Kei Wan"},"SOH":{"line":{"SIL":{}},"chi":"Êµ∑ÊÄ°ÂçäÂ≥∂","eng":"South Horizons"},"SSP":{"line":{"TWL":{}},"chi":"Ê∑±Ê∞¥Âüó","eng":"Sham Shui Po"},"STW":{"line":{"TML":{}},"chi":"Ê≤ôÁî∞Âúç","eng":"Sha Tin Wai"},"SUN":{"line":{"DRL":{},"TCL":{}},"chi":"Ê¨£Êæ≥","eng":"Sunny Bay"},"SUW":{"line":{"TML":{}},"chi":"ÂÆãÁöáËá∫","eng":"Sung Wong Toi"},"SWH":{"line":{"ISL":{}},"chi":"Ë•øÁÅ£Ê≤≥","eng":"Sai Wan Ho"},"SYP":{"line":{"ISL":{}},"chi":"Ë•øÁáüÁõ§","eng":"Sai Ying Pun"},"TAK":{"line":{"ISL":{}},"chi":"Â§™Âè§","eng":"Tai Koo"},"TAP":{"line":{"EAL":{}},"chi":"Â§ßÂüîÂ¢ü","eng":"Tai Po Market"},"TAW":{"line":{"EAL":{},"TML":{}},"chi":"Â§ßÂúç","eng":"Tai Wai"},"TIH":{"line":{"ISL":{}},"chi":"Â§©Âêé","eng":"Tin Hau"},"TIK":{"line":{"KTL":{},"TKL":{}},"chi":"Ë™øÊôØÂ∂∫","eng":"Tiu Keng Leng"},"TIS":{"line":{"TML":{}},"chi":"Â§©Ê∞¥Âúç","eng":"Tin Shui Wai"},"TKO":{"line":{"TKL":{}},"chi":"Â∞áËªçÊæ≥","eng":"Tseung Kwan O"},"TKW":{"line":{"TML":{}},"chi":"ÂúüÁìúÁÅ£","eng":"To Kwa Wan"},"TSH":{"line":{"TML":{}},"chi":"Â§ßÊ∞¥Âùë","eng":"Tai Shui Hang"},"TST":{"line":{"TWL":{}},"chi":"Â∞ñÊ≤ôÂíÄ","eng":"Tsim Sha Tsui"},"TSW":{"line":{"TWL":{}},"chi":"ËçÉÁÅ£","eng":"Tsuen Wan"},"TSY":{"line":{"AEL":{},"TCL":{}},"chi":"ÈùíË°£","eng":"Tsing Yi"},"TUC":{"line":{"TCL":{}},"chi":"Êù±Ê∂å","eng":"Tung Chung"},"TUM":{"line":{"TML":{}},"chi":"Â±ØÈñÄ","eng":"Tuen Mun"},"TWH":{"line":{"TWL":{}},"chi":"Â§ßÁ™©Âè£","eng":"Tai Wo Hau"},"TWO":{"line":{"EAL":{}},"chi":"Â§™Âíå","eng":"Tai Wo"},"TWW":{"line":{"TML":{}},"chi":"ËçÉÁÅ£Ë•ø","eng":"Tsuen Wan West"},"UNI":{"line":{"EAL":{}},"chi":"Â§ßÂ≠∏","eng":"University"},"WAC":{"line":{"ISL":{}},"chi":"ÁÅ£‰ªî","eng":"Wan Chai"},"WCH":{"line":{"SIL":{}},"chi":"ÈªÉÁ´πÂùë","eng":"Wong Chuk Hang"},"WHA":{"line":{"KTL":{}},"chi":"ÈªÉÂüî","eng":"Whampoa"},"WKS":{"line":{"TML":{}},"chi":"ÁÉèÊ∫™Ê≤ô","eng":"Wu Kai Sha"},"WTS":{"line":{"KTL":{}},"chi":"ÈªÉÂ§ß‰ªô","eng":"Wong Tai Sin"},"YAT":{"line":{"KTL":{},"TKL":{}},"chi":"Ê≤πÂ°ò","eng":"Yau Tong"},"YMT":{"line":{"KTL":{},"TWL":{}},"chi":"Ê≤πÈ∫ªÂú∞","eng":"Yau Ma Tei"},"YUL":{"line":{"TML":{}},"chi":"ÂÖÉÊúó","eng":"Yuen Long"}};
        const STA_COORD = [{"sta":"AWE","latitude":22.3218,"longitude":113.9412},{"sta":"AIR","latitude":22.316,"longitude":113.9366},{"sta":"TSY","latitude":22.3584,"longitude":114.107},{"sta":"KOW","latitude":22.3049,"longitude":114.1615},{"sta":"HOK","latitude":22.285,"longitude":114.158},{"sta":"SUN","latitude":22.3318,"longitude":114.0288},{"sta":"DIS","latitude":22.3155,"longitude":114.0451},{"sta":"LOW","latitude":22.5283,"longitude":114.1134},{"sta":"SHS","latitude":22.5012,"longitude":114.128},{"sta":"FAN","latitude":22.4921,"longitude":114.1387},{"sta":"TWO","latitude":22.4511,"longitude":114.1611},{"sta":"TAP","latitude":22.4446,"longitude":114.1706},{"sta":"UNI","latitude":22.4134,"longitude":114.2102},{"sta":"FOT","latitude":22.3953,"longitude":114.1982},{"sta":"SHT","latitude":22.3825,"longitude":114.1875},{"sta":"TAW","latitude":22.3731,"longitude":114.1786},{"sta":"KOT","latitude":22.337,"longitude":114.1762},{"sta":"MKK","latitude":22.3222,"longitude":114.1728},{"sta":"HUH","latitude":22.3029,"longitude":114.1816},{"sta":"EXC","latitude":22.2818,"longitude":114.1754},{"sta":"ADM","latitude":22.2788,"longitude":114.1646},{"sta":"LMC","latitude":22.5144,"longitude":114.0657},{"sta":"CHW","latitude":22.2644,"longitude":114.2368},{"sta":"HFC","latitude":22.2769,"longitude":114.2398},{"sta":"SKW","latitude":22.2789,"longitude":114.2289},{"sta":"SWH","latitude":22.2816,"longitude":114.2224},{"sta":"TAK","latitude":22.2846,"longitude":114.2161},{"sta":"QUB","latitude":22.2878,"longitude":114.2096},{"sta":"NOP","latitude":22.2909,"longitude":114.2007},{"sta":"FOH","latitude":22.2881,"longitude":114.1936},{"sta":"TIH","latitude":22.2827,"longitude":114.1917},{"sta":"CAB","latitude":22.2802,"longitude":114.1835},{"sta":"WAC","latitude":22.2773,"longitude":114.1728},{"sta":"CEN","latitude":22.282,"longitude":114.1576},{"sta":"SHW","latitude":22.2862,"longitude":114.1518},{"sta":"SYP","latitude":22.2856,"longitude":114.1427},{"sta":"HKU","latitude":22.2841,"longitude":114.1356},{"sta":"KET","latitude":22.2812,"longitude":114.1285},{"sta":"TIK","latitude":22.3042,"longitude":114.2524},{"sta":"YAT","latitude":22.2979,"longitude":114.2371},{"sta":"LATitude","latitude":22.3068,"longitude":114.233},{"sta":"KWT","latitude":22.3121,"longitude":114.2265},{"sta":"NTK","latitude":22.3154,"longitude":114.2193},{"sta":"KOB","latitude":22.3235,"longitude":114.2141},{"sta":"CHH","latitude":22.3348,"longitude":114.2089},{"sta":"DIH","latitude":22.3401,"longitude":114.2016},{"sta":"WTS","latitude":22.3417,"longitude":114.1939},{"sta":"LOF","latitude":22.338,"longitude":114.1871},{"sta":"SKM","latitude":22.332,"longitude":114.1687},{"sta":"PRE","latitude":22.3245,"longitude":114.1683},{"sta":"MOK","latitude":22.3191,"longitude":114.1694},{"sta":"YMT","latitude":22.3129,"longitude":114.1707},{"sta":"HOM","latitude":22.3093,"longitude":114.1829},{"sta":"WHA","latitude":22.305,"longitude":114.1896},{"sta":"WKS","latitude":22.4291,"longitude":114.2438},{"sta":"MOS","latitude":22.4247,"longitude":114.2316},{"sta":"HEO","latitude":22.4174,"longitude":114.2258},{"sta":"TSH","latitude":22.4088,"longitude":114.223},{"sta":"SHM","latitude":22.3877,"longitude":114.2083},{"sta":"CIO","latitude":22.3828,"longitude":114.2035},{"sta":"STW","latitude":22.3771,"longitude":114.195},{"sta":"CKT","latitude":22.3748,"longitude":114.1861},{"sta":"HIK","latitude":22.364,"longitude":114.1708},{"sta":"KAT","latitude":22.3304,"longitude":114.1994},{"sta":"SUW","latitude":22.3258,"longitude":114.1914},{"sta":"TKW","latitude":22.3172,"longitude":114.1876},{"sta":"ETS","latitude":22.2955,"longitude":114.1754},{"sta":"AUS","latitude":22.3046,"longitude":114.1665},{"sta":"NAC","latitude":22.3268,"longitude":114.1533},{"sta":"MEF","latitude":22.3381,"longitude":114.1376},{"sta":"TWW","latitude":22.3686,"longitude":114.1098},{"sta":"KSR","latitude":22.4348,"longitude":114.0634},{"sta":"YUL","latitude":22.4461,"longitude":114.0352},{"sta":"LOP","latitude":22.4477,"longitude":114.0253},{"sta":"TIS","latitude":22.4481,"longitude":114.0046},{"sta":"SIH","latitude":22.412,"longitude":113.9786},{"sta":"TUM","latitude":22.3952,"longitude":113.9731},{"sta":"TUC","latitude":22.2893,"longitude":113.9416},{"sta":"LAK","latitude":22.3484,"longitude":114.1261},{"sta":"OLY","latitude":22.3178,"longitude":114.1602},{"sta":"POA","latitude":22.3224,"longitude":114.258},{"sta":"HAH","latitude":22.3156,"longitude":114.2644},{"sta":"TKO","latitude":22.3074,"longitude":114.26},{"sta":"LHP","latitude":22.2957,"longitude":114.2689},{"sta":"TSW","latitude":22.3736,"longitude":114.1178},{"sta":"TWH","latitude":22.3708,"longitude":114.125},{"sta":"KWH","latitude":22.3632,"longitude":114.1312},{"sta":"KWF","latitude":22.3569,"longitude":114.1279},{"sta":"LCK","latitude":22.3373,"longitude":114.1482},{"sta":"CSW","latitude":22.3354,"longitude":114.1563},{"sta":"SSP","latitude":22.3307,"longitude":114.1623},{"sta":"JOR","latitude":22.3049,"longitude":114.1718},{"sta":"TST","latitude":22.2973,"longitude":114.1722},{"sta":"OCP","latitude":22.2486,"longitude":114.1743},{"sta":"WCH","latitude":22.248,"longitude":114.1681},{"sta":"LET","latitude":22.2421,"longitude":114.1562},{"sta":"SOH","latitude":22.2425,"longitude":114.1491}];
        // utility
        Array.prototype.distinct = function(){ return [...new Set(this)] };
        Array.prototype.except = function(x){return this.filter(y=>x!=y)};
        // d - calc distance between two latitude-longitude, result in meters
        let d = (d1,d2) => { let latitude=d1.latitude-d2.latitude, longitude=d1.longitude-d2.longitude; return 100000*Math.sqrt(latitude*latitude+longitude*longitude) }
        // g - fetching from web and put the latest into STATIONS
        let g = async (l,s) => {
            let u = `https://rt.data.gov.hk/v1/transport/mtr/getSchedule.php?line=${l}&sta=${s}`; console.log(u);
            return fetch(u).then(x=>x.json()).then(o => {
                Object.entries(o['data']).forEach(([p,d]) => {
                    Object.entries((Object.groupBy([d.UP??[], d.DOWN??[]].flat(1), ({plat})=>plat))).forEach(([plat,time]) => {
                        STATIONS[s][l][plat+''] = time; r();
                    });
                });
            });
        }
        // r - generate HTML and render (order: sta -> line -> dest -> time)
        let r = () => {
            setTimeout(() => {$('#spin').style.display = 'none'}, 300);
            let currTime = new Date();
            let ss = Object.entries(STATIONS).map(([sta, line_dict]) => {
                let plats = Object.entries(line_dict).map(([line, plat_dict]) => {
                    return Object.entries(plat_dict).map(([plat, time_list]) => {
                        // Math.floor((new Date(x.time)-currTime)/60000)
                        let ttnt = time_list.map(x=>x.ttnt).filter(x=>x<=10).join(', ');
                        return Mustache.render($('#TstaDest').innerHTML, {line, plat, dest: time_list.map(x=>REF[x.dest].chi).distinct().join(' / '), ttnt:ttnt==''?'-':ttnt});
                    }).join('');
                }).join('');
                return Mustache.render($('#Tsta').innerHTML, {sta: REF[sta].chi, prox: PROX_STA.indexOf(sta)>=0?'üìç':'',  plats});
            }).join('');
            $('#main').innerHTML = ss + "<div id='bpad'></div>";
            $('#time').innerText = 'Last update: ' + new Date().toLocaleTimeString();
        }
        // f - running the actual fetch in a loop
        let f = () => {
            $('#spin').style.display = 'block';
            navigator.geolocation.getCurrentPosition(x => {
                let t = STA_COORD.filter(y=>d(x.coords,y)<=500).map(y=>y.sta);
                t.except(PROX_STA.concat(DEFAULT_STA)).forEach(x => STATIONS[x] = REF[x].line); // add
                PROX_STA.except(t.except(DEFAULT_STA)).forEach(x => {delete STATIONS[x]}); // remove
                PROX_STA = t;
                Object.entries(STATIONS).forEach(([s,ls]) => { Object.keys(ls).forEach(l => g(l,s)) });
            }, () => {
                Object.entries(STATIONS).forEach(([s,ls]) => { Object.keys(ls).forEach(l => g(l,s)) });
            });
        }
        // initialize
        var STATIONS = Object.fromEntries(DEFAULT_STA.map(s=>[s, REF[s].line]));
        let main = $('#main'); main.addEventListener('scroll', x=> { main.className = x.target.scrollTop>5?'scrolling':''});
        // feel free to fork this and make it usable for yourself
        if (window.location.host.indexOf('1')===0) {
            f(); $('#titl').addEventListener('touchstart', f);
        } else {
            $('#titl').innerText = 'Unknown User';
            crypto.subtle.digest('SHA-256', new TextEncoder().encode(window.location.href.split('?')[1]))
                .then(x=>Array.from(new Uint8Array(x)))
                .then(x=>x.map(b => b.toString(16).padStart(2, '0')).join(''))
                .then(h=>{if(h==='c0f3a4bad8c9b0e6f89d5624668f3df44f93bb7971323b496c0f3cd79f9f592c'){
                    f(); $('#titl').addEventListener('touchstart', f);
                }
            });
        }
        main.style.height = window.innerHeight - 50;
        // debug
        // var STATIONS = JSON.parse("{\"NAC\":{\"TML\":{\"1\":[{\"seq\":\"1\",\"dest\":\"TUM\",\"plat\":\"1\",\"time\":\"2024-07-15 13:41:22\",\"ttnt\":\"1\",\"valid\":\"Y\",\"source\":\"-\"},{\"seq\":\"2\",\"dest\":\"TUM\",\"plat\":\"1\",\"time\":\"2024-07-15 13:48:22\",\"ttnt\":\"8\",\"valid\":\"Y\",\"source\":\"-\"},{\"seq\":\"3\",\"dest\":\"TUM\",\"plat\":\"1\",\"time\":\"2024-07-15 13:55:22\",\"ttnt\":\"15\",\"valid\":\"Y\",\"source\":\"-\"},{\"seq\":\"4\",\"dest\":\"TUM\",\"plat\":\"1\",\"time\":\"2024-07-15 14:02:22\",\"ttnt\":\"22\",\"valid\":\"Y\",\"source\":\"-\"}],\"2\":[{\"seq\":\"1\",\"dest\":\"WKS\",\"plat\":\"2\",\"time\":\"2024-07-15 13:42:22\",\"ttnt\":\"2\",\"valid\":\"Y\",\"source\":\"-\"},{\"seq\":\"2\",\"dest\":\"WKS\",\"plat\":\"2\",\"time\":\"2024-07-15 13:49:22\",\"ttnt\":\"9\",\"valid\":\"Y\",\"source\":\"-\"},{\"seq\":\"3\",\"dest\":\"WKS\",\"plat\":\"2\",\"time\":\"2024-07-15 13:56:22\",\"ttnt\":\"16\",\"valid\":\"Y\",\"source\":\"-\"},{\"seq\":\"4\",\"dest\":\"WKS\",\"plat\":\"2\",\"time\":\"2024-07-15 14:03:22\",\"ttnt\":\"23\",\"valid\":\"Y\",\"source\":\"-\"}]},\"TCL\":{\"3\":[{\"ttnt\":\"2\",\"valid\":\"Y\",\"plat\":\"3\",\"time\":\"2024-07-15 13:41:00\",\"source\":\"-\",\"dest\":\"TUC\",\"seq\":\"1\"},{\"ttnt\":\"8\",\"valid\":\"Y\",\"plat\":\"3\",\"time\":\"2024-07-15 13:49:00\",\"source\":\"+\",\"dest\":\"TUC\",\"seq\":\"2\"},{\"ttnt\":\"15\",\"valid\":\"Y\",\"plat\":\"3\",\"time\":\"2024-07-15 13:55:00\",\"source\":\"+\",\"dest\":\"TUC\",\"seq\":\"3\"},{\"ttnt\":\"22\",\"valid\":\"Y\",\"plat\":\"3\",\"time\":\"2024-07-15 14:03:00\",\"source\":\"+\",\"dest\":\"TUC\",\"seq\":\"4\"}],\"4\":[{\"ttnt\":\"5\",\"valid\":\"Y\",\"plat\":\"4\",\"time\":\"2024-07-15 13:45:00\",\"source\":\"-\",\"dest\":\"HOK\",\"seq\":\"1\"},{\"ttnt\":\"13\",\"valid\":\"Y\",\"plat\":\"4\",\"time\":\"2024-07-15 13:52:00\",\"source\":\"-\",\"dest\":\"HOK\",\"seq\":\"2\"},{\"ttnt\":\"19\",\"valid\":\"Y\",\"plat\":\"4\",\"time\":\"2024-07-15 13:58:00\",\"source\":\"-\",\"dest\":\"HOK\",\"seq\":\"3\"},{\"ttnt\":\"25\",\"valid\":\"Y\",\"plat\":\"4\",\"time\":\"2024-07-15 14:06:00\",\"source\":\"+\",\"dest\":\"HOK\",\"seq\":\"4\"}]}},\"HOK\":{\"AEL\":{\"1\":[{\"ttnt\":\"0\",\"valid\":\"Y\",\"plat\":\"1\",\"time\":\"2024-07-15 13:41:00\",\"source\":\"-\",\"dest\":\"AWE\",\"seq\":\"1\"},{\"ttnt\":\"10\",\"valid\":\"Y\",\"plat\":\"1\",\"time\":\"2024-07-15 13:50:00\",\"source\":\"+\",\"dest\":\"AWE\",\"seq\":\"2\"},{\"ttnt\":\"19\",\"valid\":\"Y\",\"plat\":\"1\",\"time\":\"2024-07-15 14:00:00\",\"source\":\"+\",\"dest\":\"AWE\",\"seq\":\"3\"},{\"ttnt\":\"29\",\"valid\":\"Y\",\"plat\":\"1\",\"time\":\"2024-07-15 14:10:00\",\"source\":\"+\",\"dest\":\"AWE\",\"seq\":\"4\"}]},\"TCL\":{\"4\":[{\"ttnt\":\"1\",\"valid\":\"Y\",\"plat\":\"4\",\"time\":\"2024-07-15 13:42:00\",\"source\":\"-\",\"dest\":\"TUC\",\"seq\":\"1\"},{\"ttnt\":\"8\",\"valid\":\"Y\",\"plat\":\"4\",\"time\":\"2024-07-15 13:48:00\",\"source\":\"+\",\"dest\":\"TUC\",\"seq\":\"2\"},{\"ttnt\":\"15\",\"valid\":\"Y\",\"plat\":\"4\",\"time\":\"2024-07-15 13:56:00\",\"source\":\"+\",\"dest\":\"TUC\",\"seq\":\"3\"},{\"ttnt\":\"22\",\"valid\":\"Y\",\"plat\":\"4\",\"time\":\"2024-07-15 14:02:00\",\"source\":\"+\",\"dest\":\"TUC\",\"seq\":\"4\"}]}},\"SYP\":{\"ISL\":{\"1\":[{\"seq\":\"1\",\"dest\":\"CHW\",\"plat\":\"1\",\"time\":\"2024-07-15 13:43:24\",\"ttnt\":\"3\",\"valid\":\"Y\",\"source\":\"-\"},{\"seq\":\"2\",\"dest\":\"CHW\",\"plat\":\"1\",\"time\":\"2024-07-15 13:47:24\",\"ttnt\":\"7\",\"valid\":\"Y\",\"source\":\"-\"},{\"seq\":\"3\",\"dest\":\"CHW\",\"plat\":\"1\",\"time\":\"2024-07-15 13:50:24\",\"ttnt\":\"10\",\"valid\":\"Y\",\"source\":\"-\"},{\"seq\":\"4\",\"dest\":\"CHW\",\"plat\":\"1\",\"time\":\"2024-07-15 13:54:24\",\"ttnt\":\"14\",\"valid\":\"Y\",\"source\":\"-\"}],\"2\":[{\"seq\":\"1\",\"dest\":\"KET\",\"plat\":\"2\",\"time\":\"2024-07-15 13:44:24\",\"ttnt\":\"4\",\"valid\":\"Y\",\"source\":\"-\"},{\"seq\":\"2\",\"dest\":\"KET\",\"plat\":\"2\",\"time\":\"2024-07-15 13:46:24\",\"ttnt\":\"6\",\"valid\":\"Y\",\"source\":\"-\"},{\"seq\":\"3\",\"dest\":\"KET\",\"plat\":\"2\",\"time\":\"2024-07-15 13:51:24\",\"ttnt\":\"11\",\"valid\":\"Y\",\"source\":\"-\"},{\"seq\":\"4\",\"dest\":\"KET\",\"plat\":\"2\",\"time\":\"2024-07-15 13:54:24\",\"ttnt\":\"14\",\"valid\":\"Y\",\"source\":\"-\"}]}},\"CEN\":{\"ISL\":{\"3\":[{\"seq\":\"1\",\"dest\":\"CHW\",\"plat\":\"3\",\"time\":\"2024-07-15 13:42:24\",\"ttnt\":\"2\",\"valid\":\"Y\",\"source\":\"-\"},{\"seq\":\"2\",\"dest\":\"CHW\",\"plat\":\"3\",\"time\":\"2024-07-15 13:46:24\",\"ttnt\":\"6\",\"valid\":\"Y\",\"source\":\"-\"},{\"seq\":\"3\",\"dest\":\"CHW\",\"plat\":\"3\",\"time\":\"2024-07-15 13:51:24\",\"ttnt\":\"11\",\"valid\":\"Y\",\"source\":\"-\"},{\"seq\":\"4\",\"dest\":\"CHW\",\"plat\":\"3\",\"time\":\"2024-07-15 13:54:24\",\"ttnt\":\"14\",\"valid\":\"Y\",\"source\":\"-\"}],\"4\":[{\"seq\":\"1\",\"dest\":\"KET\",\"plat\":\"4\",\"time\":\"2024-07-15 13:40:24\",\"ttnt\":\"0\",\"valid\":\"Y\",\"source\":\"-\"},{\"seq\":\"2\",\"dest\":\"KET\",\"plat\":\"4\",\"time\":\"2024-07-15 13:42:24\",\"ttnt\":\"2\",\"valid\":\"Y\",\"source\":\"-\"},{\"seq\":\"3\",\"dest\":\"KET\",\"plat\":\"4\",\"time\":\"2024-07-15 13:47:24\",\"ttnt\":\"7\",\"valid\":\"Y\",\"source\":\"-\"},{\"seq\":\"4\",\"dest\":\"KET\",\"plat\":\"4\",\"time\":\"2024-07-15 13:50:24\",\"ttnt\":\"10\",\"valid\":\"Y\",\"source\":\"-\"}]},\"TWL\":{\"1\":[{\"seq\":\"2\",\"dest\":\"TSW\",\"plat\":\"1\",\"time\":\"2024-07-15 13:45:16\",\"ttnt\":\"5\",\"valid\":\"Y\",\"source\":\"-\"},{\"seq\":\"4\",\"dest\":\"TSW\",\"plat\":\"1\",\"time\":\"2024-07-15 13:52:16\",\"ttnt\":\"12\",\"valid\":\"Y\",\"source\":\"-\"}],\"2\":[{\"seq\":\"1\",\"dest\":\"TSW\",\"plat\":\"2\",\"time\":\"2024-07-15 13:41:16\",\"ttnt\":\"1\",\"valid\":\"Y\",\"source\":\"-\"},{\"seq\":\"3\",\"dest\":\"TSW\",\"plat\":\"2\",\"time\":\"2024-07-15 13:48:16\",\"ttnt\":\"8\",\"valid\":\"Y\",\"source\":\"-\"}]}}}"); r();
    </script>
</body>
</html>